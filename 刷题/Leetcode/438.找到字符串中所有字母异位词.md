---
title: 找到字符串中所有字母异位词
date: 2022-08-27 21:50:00
tags:
categories:
- 刷题
---

不固定长度的滑动窗口：
```javascript
/**
 * @param {string} s
 * @param {string} p
 * @return {number[]}
 */
var findAnagrams = function(s, p) {
    var slen = s.length
    var plen = p.length

    // 对 p 中字符进行统计
    var need = {}
    for (var i = 0; i < plen; i++) {
        if (need[p[i]] === undefined) {
            need[p[i]] = 0
        }
        need[p[i]]++
    }

    var ans = []
    // 遍历 s 串查找异位词
    var left = 0
    var right = 0
    var have = {}
    while (right < slen) {
        var sc = s[right]
        right++
        if (need[sc] === undefined) {
            // 该字符没有在 p 中出现，属于无效字符，需略过，重新开始
            have = {}
            left = right
        } else {
            if (have[sc] === undefined) {
                have[sc] = 0
            }
            have[sc]++
            // 判断已处理的字符串中是否都包含了 p 中字符
            var ishaved = true
            for (var kc in need) {
                if (have[kc] === undefined || have[kc] < need[kc]) {
                    ishaved = false
                }
            }
            // 已包含就开始优化滑动窗口
            if (ishaved) {
                while (left < right) {
                    // console.log(left, right)
                    var leftc = s[left]
                    have[leftc]--
                    var isFit = true
                    for (var kc in need) {
                        if (have[kc] < need[kc]) {
                            isFit = false
                            break
                        }
                    }
                    // 删掉一个元素导致包含失效，则恢复
                    if (!isFit) {
                        have[leftc]++
                        break
                    }
                    left++
                }
                var isExtra = false
                for (var kc in need) {
                    if (have[kc] !== need[kc]) {
                        isExtra = true
                        break
                    }
                }
                if (isExtra) {
                    continue
                }
                if (ans.length === 0 || ans[ans.length-1] < left) {
                    ans.push(left)
                }      
            }
            // 没有完全包含就继续向右扩大滑动窗口
        }
    }
    return ans
};
```

方法二，固定长度滑动窗口：
```javascript
/**
 * @param {string} s
 * @param {string} p
 * @return {number[]}
 */
var charIndex = function(char) {
    return char.charCodeAt(0) - 'a'.charCodeAt(0)
}
var range = 26
var findAnagrams = function(s, p) {
    var slen = s.length
    var plen = p.length

    if (slen < plen) {
        return []
    }

    // 对 p 中字符进行统计
    var need = new Array(range).fill(0)
    for (var i = 0; i < plen; i++) {
        need[charIndex(p[i])]++
    }
    // console.log(need)

    var ans = []
    var have = new Array(range).fill(0)
    var left = 0
    for (var i = 0; i < slen; i++) {
        // 该字符未在 p 中出现
        if (need[charIndex(s[i])] === 0) {
            // 清空 have 记录
            while (left < i) {
                have[charIndex(s[left++])]--
            }
            // left 放置在下一位开始位置
            left++
        } else {
            have[charIndex(s[i])]++
            if (i - left + 1 === plen) {
                // console.log(i, left)
                var isMatched = true
                for (var j = 0; j < range; j++) {
                    if (need[j] !== have[j]) {
                        isMatched = false
                        break
                    }
                }
                if (isMatched) {
                    ans.push(left)
                }
                // console.log(left)
                have[charIndex(s[left++])]--
            }
        }
    }
    return ans
};
```


## 参考
[1] https://leetcode.cn/problems/contains-duplicate-ii/