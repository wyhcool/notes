---
title: 接口、lambda 表达式与内部类
date: 2020-01-18 13:10:00
update:
tags:
categories:
- Java
---

接口(interface)技术主要用来描述类具有什么功能，而并不给出每个功能的具体实现。一个类可以实现(implement)一个或多个接口，并在需要接口的地方，随时使用实现了相应接口的对象。

lambda 表达式是一种表示可以在将来某个时间点执行的代码块的简洁方法，使用 lambda 表达式，可以用一种精巧而简洁的方式表示使用回调或变量行为的代码。

内部类(inner class)定义在另外一个类的内部，其中的方法可以访问它们的外部类的域。内部类技术主要用于设计具有相互协作关系的类集合。

代理(proxy)是一种实现任意接口的对象。代理是一种非常专业的构造工具，它可以用来构造系统级的工具。


## 接口
### 接口概念
接口不是类，而是对类的一组需求描述，这些类要遵从接口描述的统一格式进行定义。

`Arrays` 类中的 `sort` 方法承诺可以对数组对象进行排序，但要求满足：对象所属的类必须实现了 `Comparable` 接口：
```java
public interface Comparable {
    int compareTo(Object other);
}
```
这就是说，任何实现 `Comparable` 接口的类都需要包含 `compareTo` 方法，并且这个方法的参数必须是一个 `Object` 对象，返回一个整型数值。
```java
// 在 Java SE 5.0 中，Comparable 接口已经改进为泛型类型：
public interface Comparable<T> {
    int compareTo(T other); // parameter has type T
}

// 在实现 Comparable<Employee> 接口的类中，必须提供下列方法：
int compareTo(Employee other);

// 还可以使用不带类型参数的原始 Comparable 类型，这样一来，compareTo
// 方法就有一个 Object 类型的参数，必须手动将 compareTo 方法的参数强制
// 转换为所希望的类型。
```
接口中的所有方法自动地属于 `public`，因此，在接口中声明方法时，不必提供关键字 `public`。

接口中还有一个没有明确说明的附加要求：在调用 `x.compareTo(y)` 时，这个方法必须确实比较两个对象的内容，并返回比较的结果。当 x 小于 y 时，返回一个负数；当 x 等于 y 时，返回 0；否则返回一个正数。

一个接口可以包含多个方法。

在接口中可以定义常量。

最重要的是接口不能提供哪些功能：接口绝不能含有实例域，在 Java SE 8 之前，也不能在接口中实现方法。当然，这些方法不能引用实例域 —— 接口没有实例。

提供实例域和方法实现的任务由实现接口的类来完成。

为了让类实现一个接口，通常需要下面两个步骤：
- 将类声明为实现给定的接口；
- 对接口中的所有方法进行定义。

要将类声明为实现某个接口，需要使用关键字 `implements`。

警告⚠️：在实现方法时，必须把方法声明为 `public`，否则，编译器将认为这个方法的访问属性是包可见性，即类的默认访问属性，之后编译器就会给出试图提供更严格的访问权限的警告信息。
```java
class Employee implements Comparable<Employee> {
    public int compareTo(Employee other) {
        return Double.compare(salary, other.salary);
    }
}
```
提示：ℹ️ `Comparable` 接口中的 `compareTo` 方法将返回一个整型数值。但需注意：在对两个整数域进行比较时，整数的范围不能过大，以避免造成减法运算的溢出。如果确信两个整数均为非负整数，或者它们的绝对值不会超过 `(Integer.MAX_VALUE-1)/2`，就不会出现问题，否则，调用静态 `Integer.compare` 方法。在对两个浮点数值域进行比较时，当它们很接近但又不相等的时候，它们的差经过四舍五入后有可能变成 0。

要让一个类使用排序服务必须让它实现 `compareTo` 方法，这是理所当然的，因为要向 `sort` 方法提供对象的比较方式。但是为什么不能在 `Employee` 类直接提供一个 `compareTo` 方法，而必须实现 `Comparable` 接口呢？

主要原因是：Java 程序设计语言是一种强类型(strongly typed)语言。在调用方法的时候，编译器将会检查这个方法是否存在。
```java
// 在 sort 方法中存在下列语句：
if (a[i].compareTo(a[j]) > 0) {
    //...
}
// 为此，编译器必须确认 a[i] 一定要有 compareTo 方法。
// 如果a是一个 Comparable 对象的数组，就可以确保拥有 compareTo 方法
// 因为每个实现 Comparable 接口的类都必须提供这个方法的定义。
```
java.lang.Comparable\<T> 用到的方法：
- int compareTo(T other)：用这个对象与 other 进行比较。如果这个对象小于 other 则返回负值；如果相等则返回 0；否则返回正值。

java.util.Arrays 用到的方法：
- static void sort(Object[] a)：使用 mergesort 算法对数组 a 中的元素进行排序。要求数组中的元素必须属于实现了 Comparable 接口的类，并且元素之间必须是可比较的。

java.lang.Integer 用到的方法：
- static int compare(int x, int y)：如果 x \< y 返回一个负整数；如果 x 和 y 相等，则返回 0；否则返回一个正整数。

java.lang.Double 用到的方法：
- static int compare(double x, double y)：如果 x \< y 返回一个负整数；如果 x 和 y 相等，则返回 0；否则返回一个正整数。

语言标准规定：对于任意的 x 和 y，实现必须能够保证 `sgn(x.compareTo(y)) = -sgn(y.compareTo(x))`（也就是说，如果 `y.compareTo(x)` 抛出一个异常，那么 `x.compareTo(y)` 也应该抛出一个异常。）其中 `sgn` 是一个数值的符号：如果 n 是负值，`sgn(n)` 返回 -1；如果 n 是 0，`sgn(n)` 返回 0；如果 n 是正值，`sgn(n)` 返回 1。


## lambda 表达式


## 内部类


## 代理


## 参考
[1] Java核心技术.卷Ⅰ.基础知识(原书第10版).机械工业出版社,2016.8