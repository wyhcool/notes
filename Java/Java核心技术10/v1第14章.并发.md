---
title: 并发
date: 2019-03-22 10:40:00
tags:
categories:
- Java
---

操作系统的多任务(multitasking)是指在同一时刻运行多个程序的能力。

多线程程序是在较低的层次上扩展了多任务(multitasking)的概念：一个程序同时执行多个任务。通常，每一个任务称为一个线程(thread)，它是线程控制的简称。可以同时运行一个以上线程的程序称为多线程程序(multithreaded)。

多进程与多线程有哪些区别呢？本质的区别在于每个进程拥有自己的一整套变量，而线程则共享数据。共享变量使线程之间的通信比进程之间的通信更有效、更容易。此外，在某些操作系统中，与进程相比较，线程更轻量级，创建、撤销一个线程比启动新进程的开销要小得多。

## 什么是线程
调用 `Thread.sleep` 方法不会创建一个新线程，而是用于暂停当前线程的活动。`sleep` 方法可以抛出一个 `InterruptedException` 异常。

在没有使用多线程时，用户很难让它执行多个任务。必须等待上一个过程执行完毕才能与程序进行交互。

### 使用线程给其他任务提供机会
可以将移动球的代码放置在一个独立的线程中，运行这段代码可以提高弹跳球的响应能力。实际上，可以发起多个球，每个球都在自己的线程中运行。

另外，AWT 的事件分配线程(event dispatch thread)将一直地并行运行，以处理用户界面的事件。由于每个线程都有机会得以运行，所在在球弹跳期间，当用户点击 Close 按钮时，事件调度线程将有机会关注到这个事件，并处理关闭动作。

通常，需要警惕任何长时间运行的计算，这计算可能是更大的框架（例如 GUI 或 Web 框架）的一部分。每当框架调用方法时，通常都会期望快速的返回。如果需要执行任何耗时的任务，则应当并发地运行任务。

在一个单独地线程中执行一个任务的过程：
1) 将任务代码移到实现了 `Runnable` 接口的类的 `run` 方法中，这个接口只有一个方法，是一个函数式接口，可以用 lambda 表达式建立一个实例：
```java
public interface Runnable {
    void run();
}

Runnable r = () -> { /* task code */ }
```
2) 由 `Runnable` 创建一个 `Thread` 对象：
```java
Thread t = new Thread(r);
```
3) 启动线程：
```java
t.start();
```

将弹跳球代码放在一个独立的线程中，只需要实现一个类 `BallRunnable`，然后将动画代码放在 run 方法中：
```java
new Thread(()-> {
    try {
        for (int i = 1; i <= STEPS; i++) {
            ball.move(comp.getBounds());
            comp.repaint();
            Thread.sleep(DELAY);
        }
    } catch (InterruptedException e) {

    }
}).start();
```
在一般情况下，线程在中断时被终止。因此，当发生 `InterruptedException` 异常时，`run` 方法将结束执行。

应该将要并行运行的任务与运行机制解耦合，如果有很多任务，要为每个任务创建一个独立的线程所付出的代价太大了，可以使用线程池来解决这个问题。

警告⚠️：不要调用 `Thread` 类或 `Runnable` 对象的 `run` 方法。直接调用 `run` 方法，只会执行同一个线程中的任务，而不会启动新线程。应该调用 `Thread.start` 方法，这个方法将创建一个执行 `run` 方法的新线程。




## 中断线程


## 线程状态


## 线程属性


## 同步


## 阻塞队列


## 线程安全的集合


## Collable 与 Future


## 执行器


## 同步器


## 线程与 Swing


## 参考
[1] Java核心技术.卷Ⅰ.基础知识(原书第10版).机械工业出版社,2016.8


