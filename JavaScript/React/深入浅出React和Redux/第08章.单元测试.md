---
title: 单元测试
date: 2022-05-15 11:19:00
tags:
categories:
- React
---

## 单元测试原则
从不同的角度，可将测试划分为不同的种类：
- 从人工操作还是写代码来操作的角度，可以分为手工测试和自动化测试；
- 从是否需要考虑系统的内部设计角度，可以分为白盒测试和黑盒测试；
- 从测试对象的级别，可以分为单元测试、集成测试和端到端测试；
- 从测试验证的系统特性，可以分为功能测试、性能测试和压力测试。

单元测试是一种自动化测试，测试代码和被测的对象非常相关，单元测试代码一般都由编写对应功能代码的开发者来编写，开发者提交的单元测试代码应该保持一定的覆盖率，而且必须永远能够运行通过，单元测试是保证代码质量的第一道防线。

程序架构的可测试性非常重要，要克服单元测试太难写的问题，就需要架构能把程序拆分成足够小到方便测试的部分，只有每个小的部分被验证能够正确地各司其职，组合起来能够完成整体功能，那么开发者编写的单元测试就可以专注于测试各个小的部分就行，这就是高的可测试性。

## 单元测试环境搭建
### 单元测试框架
测试框架常见的是以下两种：
- 用 Mocha 测试框架，但是 Mocha 没有断言库，配合 Chai 断言库来使用；
- 使用 React 配套的 Jest，Jest 自带了断言等功能。

mocha \[ˈmoʊkə] n.摩卡咖啡; 优等咖啡; 加巧克力的摩卡咖啡饮料;
chai \[tʃaɪ] n.茶;
jest \[dʒest] v.开玩笑; 说笑话;n.笑话; 玩笑; 俏皮话; 打趣;

```shell
$ npm run test
```

Jest 会自动在当前目录下寻找满足下列任一条件的 JavaScript 文件作为单元测试代码来执行：
- 文件名以 `.test.js` 为后缀的代码文件；
- 存于 `__test__` 目录下的代码文件。

### 单元测试代码组织
单元测试代码的最小单位是测试用例(test case)，每一个测试用例考验的是被测试对象在某一个特定场景下是否有正确的行为。

在 Jest 框架下，每个测试用例用一个 it 函数表示，it 函数的第一个参数是一个字符串，代表的是测试用例名称，第二个参数是一个函数，包含的是实际的测试用例过程。
```javascript
it('should return object when invoked', () => {
    // 增加断言语句
})
```

为了测试被测对象在多种情况下的行为，就需要创建多个单元测试用例，使用测试套件(test suite)来组织多个 ite 函数实例。

suite \[swiːt] n.一套; (尤指旅馆的)一套房间; 一套家具; 组曲(由三个或更多相关部分组成); 套;

一个测试套件由测试用例和其他测试套件组成，测试套件可以嵌套使用，于是测试套件和测试用例形成了一个树形的组织结构。当执行某个测试套件时，按照从上到下从外到里的顺序执行所有测试用例。

在 Jest 中用 describe 函数描述测试套件：
```javascript
describe('actions', () => {
    it('should return object when invoked', () => {
    })
    // 更多的 it 函数调用
})
```

将多个 it 放到一个 describe 中的主要目的是为了重用共同的环境设置。

describe 中有如下特殊函数帮助重用代码：
- beforeAll，在开始测试套件开始之前执行一次；
- afterAll，在结束测试套件中所有测试用例之后执行一次；
- beforeEach，每个测试用例在执行之前都执行一次；
- afterEach，每个测试用例在执行之后都执行一次。


## 参考
[1] 程墨.深入浅出 React 和 Redux.机械工业出版社.2017.04

[2] https://github.com/mocheng/react-and-redux
