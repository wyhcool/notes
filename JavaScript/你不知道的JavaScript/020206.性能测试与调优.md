---
title: 性能测试与调优
date: 2020-06-10 20:42:00
tags:
categories:
- JavaScript
---

## 性能测试
### 重复
简单的数学平均值绝对不足以外推到整个应用范围的性能作出判断。

### Benchmark.js
任何有意义且可靠的性能测试都应该基于统计学上合理的实践。


## 环境为王


## 微性能
非关键路径上的优化是万恶之源。

## 尾调用优化 Tail Call Optimization, TCO
optimization \[ˌɑːptɪməˈzeɪʃn] n.最佳（优）化；优选法；（使）最恰当（适宜，适合）; 最佳条件选择；求最佳参数;

尾调用就是一个出现在另一个函数结尾处的函数调用，这个调用结束后就没有其余事情要做了，除了可能要返回结果值。
```javascript
function foo(x) {
    return x;
}

function bar(y) {
    return foo(y + 1); // 尾调用
}

function baz() {
    return 1 + bar(40); // 非尾调用
}
```
调用一个新的函数需要额外的一块预留内存来管理调用栈，称为栈帧。所以，一般会同时需要为每个 baz()、bar(..) 和 foo(..) 保留一个栈帧，然而，如果支持 TCO 的引擎能够意识到 foo(y+1) 调用位于尾部，这意味着 bar(..) 基本上已经完成了，那么在调用 foo(..) 时，它就不需要创建一个新的栈帧，而是可以重用已有的 bar(..) 的栈帧，这样不仅速度更快，也更节省内存。

有了 TCO，尾调用的递归函数本质上就可以任意运行，因为再也不需要使用额外的内存！

ES6 要求引擎实现 TCO，而不是将其留给引擎自由决定，一个原因是缺乏 TCO 会导致一些 JavaScript 算法因为调用栈限制而降低了通过递归实现的概率。

如果在所有的情况下引擎缺乏 TCO 只是降低了性能，那它就不会成为 ES6 所要求的东西。但是，由于缺乏 TCO 确实使一些程序变得无法实现，那它就成为了一个重要的语言特性而不是隐藏的实现细节。



## 参考
[1] Kyle Simpson. You Don't Know JS