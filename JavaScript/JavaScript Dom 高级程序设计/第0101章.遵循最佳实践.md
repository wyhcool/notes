---
title: 遵循最佳实践
date: 2019-03-19 08:20:00
tags:
categories:
- JavaScript
---

最佳实践是人们做事时应该遵守的、被公认和经过验证的模式。

## 不唐突和渐进增强
DOM 脚本编程用于增强(!而不是提供)文档的行为和交互性。

不唐突性(unobtrusiveness)意味着：
- 对用户来说是不唐突的，消除不必要的行为和令人讨厌的功能
- 即使在没有 JavaScript 的情况下，能使页面和标记持续有效，虽然不再那么优雅了
- 必须在标记中易于实现，可通过 ID 和类属性来关联行为，进而保证脚本与标记的分离

并非所有浏览器都遵循相同的标准创建，而且不能对所有的浏览器一视同仁。当浏览器支持相应功能时文档会得到增强(渐进增强，progressive enhancement)，而当浏览器不支持相应功能时，文档被退化(平稳退化，graceful degradation)。

“浏览器的支持性并不意味着每个人都会得到完全一样的结果。期望两个使用不同浏览器的用户拥有相同的体验就是不认同 Web 的异构本性(heterogeneous essence)”。

应该把内容的有效性和可访问性作为首要目标。

DOM 脚本编程：
- 具有可访问性。确保都能简捷而有效地访问信息，即使无法运行脚本或禁用了 JavaScript。
- 与标准兼容。只在必要时使用专有方法。
- 容易维护。以便能够集中关注业务逻辑。
- 具有可用性。以便代码复用。

## 让 JavaScript 运行起来

### 保证行为与结构的完全分离
在任何情况下，都要把全部脚本包含在一个外部源文件中。

外部文件提供的一个好处是：减少整个页面的大小，通常会被客户的 Web 浏览器缓存起来，并且只下载一次，从而减少了每个后续页面的加载时间。

### 使用能力检测，避免版本检测或浏览器嗅探
能力检测指的是在执行代码之前检测某个脚本对象或者方法是否存在。

只需在脚本开始处对要使用的所有对象和方法进行一次检测，而在万一遇到所需功能不可用时退出即可。

在检测中使用的 JavaScript 对象应该与要执行的代码中的对象和方法紧密相关。

```javascript
var W3CDOM = document.createElement && document.getElementsByTagName;

function foo() {
    if (!W3CDOM) {
        return;
    }
    //use document.createElement()
    //use document.getElementsByTagName()
}
```

如果每个浏览器都实现了同一对象，但与这个对象及其方法的交互方式不同，也不可能根据一个特殊对象或方法的存在来修改脚本代码时，那么必须使用浏览器嗅探。

### 通过平稳退化保证可访问性
在编写 DOM 脚本时不能依赖于 JavaScript 的可用性。

对于公共网页中要给所有看的重要内容，不能完全依赖 JavaScript 来生成。

### 为重用命名空间而进行规划（伪命名空间）
保持唯一性和不共享在脚本内部营造一个属于你自己的小空间。

### 通过可重用的对象把事情简化
每个人都赞同编写自己的库，把自己日常要用的东西合并到一起本身就是一件有意义的事。

只有通过自己编写代码才能学到更多东西。

## JavaScript 语法陷阱
### 区分大小写
所有的函数和变量都是区分大小写的。

### 单引号与双引号
作为一般性的规则，在 JavaScript 中使用单引号，而对 (X)HTML 属性使用双引号。因为 XHTML 规范要求所有 XHTML 属性值必须使用使用双引号括起来。

必要时使用转义。

### 换行
不论使用哪种引号来创建字符串，字符串中间都不能包含强制换行符。

如果要把字符串分割到多行中定义，要通过反斜杠来转义换行符来告知浏览器该行是连续的(换行符属于不可见字符，所以要转义换行符只需在每行结之后加上反斜杠即可)：

```javascript
var html = '<h2 class="active">A list</h2>\
    <ol>\
        <li>Foo</li>\
        <li>Bar</li>\
    </ol>';
```

上述做法会在字符串中保留空白和缩进，如果需要压缩代码时，可能会带来负面效果。

使用字符串连接操作符(+)：
```javascript
var html = '<h2 class="active">A list</h2>' +
           '<ol>' +
           '<li>Foo</li>' +
           '<li>Bar</li>' +
           '<ol>';

```

### 可选的分号和花括号
无论在什么情况下都要使用分号和花括号，编写出能清晰反映出自己意图的代码。

### 重载(并非真正的重载)
JavaScript 不支持重载。

重载是一门编程语言可以根据传递给函数或方法的参数的数据类型及参数的个数，区别不同的函数或方法的能力。

在 JavaScript 中脚本在执行时不会顾及函数定义时的参数，而是直接使用在作用域链中最后定义的那个函数。

当创建自己的函数或方法时，要确保不会覆盖现有的 JavaScript 核心元素。

### 匿名函数
匿名函数是一种在定义时不带名称的函数。

匿名函数非常适合于只应用特殊元素上的非常简单或者非常有针对性的代码。

### 作用域解析和闭包
作用域是指某一属性(变量)或方法(函数)具有访问权限的代码空间。

作用域链是用来描述一种路径的术语，沿着该路径可以确定变量的值(或者当函数被调用时要使用的方法)。

闭包是与作用域相关的一个概念，它指的是内部函数即使在外部函数执行完成并终止以后，仍然可以访问其外部函数的属性。

注意️⚠️：无法给匿名函数传递参数直接维护内部作用域，通常需要额外的函数。

### 迭代对象
for 循环使用递增控制时，可以对数组中的所有元素进行迭代。

for 循环遍历位于对象中的每个属性时，使用对象的 hasOwnProperty() 方法来避免出现意外错误。如果对象的属性或方法是非继承的，那么 hasOwnProperty() 方法返回 true，即这里的检查不涉及从其他对象继承的属性和方法，只会检查在特定对象自身中直接创建的属性。

### 函数的调用和引用(不带括号)
函数名后有圆括号时，调用函数并将它的返回值赋给一个变量。

函数名后无圆括号时，将函数的引用赋给一个变量。





## 参考
[1] 桑贝斯. JavaScript DOM高级程序设计 : AdvancED DOM Scripting: dynamic web design techniques[M]. 人民邮电出版社, 2008.