---
title: 【编写可维护的JavaScript】03 自动化 Automation
date: 2018-09-17 22:44:20
tags:
categories:
- ECMAScript
---

所有的大型 web 应用都依赖于自动化工具来处理项目中的 JavaScript 文件。把 JavaScript 加入到整个 Web 应用自动化系统中可以拥有与系统其他部分同样的保障。

使用自动化构建系统的优点：
- 本地的源代码不必同生产环境上保持一致，所以可以任意组织代码结构而不必担心在服务器上使用的代码是否需要优化
- 静态分析时可以自动发现错误
- 在部署之前有多种方式处理 JavaScript，比如文件的连接和压缩
- 通过自动化测试可以很容易发现问题
- 很方便地自动部署到生产环境

使用自动化构建系统的弊端：
- 开发者在开发环境每次改动后可能都需要在本地重新构建
- 被部署到生产的代码与开发环境编辑的代码有差异，可能很难定位线上的bug

<!-- more -->
## 第13章 文件和目录结构 File and directory structure
在开始构建系统之前首先要确定如何组织你的文件和目录。

### 最佳实践 Best practices
- 一个文件只包含一个对象。让不同的维护各自不同的文件，即完全避免多人维护一个文件的可能。
- 相关的文件用目录分组。如果有多个相关联的对象，就把这些文件都放在同一目录下。
- 保持第三方代码的独立。任何不是你写的或者不是由你维护的代码都应当独立于项目工程之外。把这些文件单独放置在项目工程中的一个目录里。
- 确定创建位置。创建后的 JavaScript 文件应该放置在一个完全独立的目录里，而且不应该提交到项目工程中。网站应当是可配置的，使用编译后的目录而非源码目录。不要把编译后的内容提交到源码工程中。
- 保持测试代码的完整性。JavaScript 测试代码应该一并提交到项目工程中的一个显眼的位置。让人很容易注意到遗漏测试的情况。


### 基本结构 Basic layout
JavaScript 目录结构包含如下三个主要的目录：
- build。用来放置最终构建后的文件。理想情况下这个目录不应该提交。
- src。用来放置所有的源文件，包括用来进行文件分组的子目录。
- test 或 tests。用来放置所有的测试文件。通常包含一些同源代码目录一一对应的子目录或文件。

## 第14章 Ant
## 第15章 校验
## 第16章 文件合并和加工
## 第17章 文件精简和压缩
文件精简是指消除不必要的空格，去除注释，并对文件做一些处理使其体积尽可能的小。文件精简处理后的文件仍然是纯文本，并且可以像通常一样编辑或加载。

压缩是指用特定的压缩方法进一步缩小文件的体积，例如 gzip。压缩处理后的文件是不可读性的并且在网页中必须先要解压后才能使用。浏览器在响应头信息中接收到 Content-Encoding: gzip 时会自动解压这些接收的文件。


## 第18章 文档化
## 第19章 自动化测试
## 第20章 组装到一起
持续集成（Continuous Integration，CI）
持续集成指的是频繁地(一天多次)将代码集成到主干。
它的好处主要有两个。
- 快速发现错误。每完成一点更新，就集成到主干，可以快速发现错误，定位错误也比较容易。
- 防止分支大幅偏离主干。如果不是经常集成，主干又在不断更新，会导致以后集成的难度变大，甚至难以集成。

持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。它的核心措施是，代码集成到主干之前，必须通过自动化测试。只要有一个测试用例失败，就不能集成。

Martin Fowler 说过，”持续集成并不能消除 Bug，而是让它们非常容易发现和改正。”



## 参考
[1] NicholasC.Zakas. 编写可维护的JavaScript[M]. 人民邮电出版社, 2013.
