---
title: 【布局】表本身如何布局
date: 2019-02-14 21:00:00
tags:
categories:
- CSS
---

## 表格式化（table formatting）

### 表的视觉编排
CSS 对于表元素和内部表元素有很分明的界限。内部表元素生成矩形框，这些框有内容、内边距和边框，但没有外边距。如果试图对单元格、行或任何其他内部表元素应用外边距，用户代理会将其忽略。（只有总标题例外）

表格单元构成了表布局的基础，表编排规则：
- 每个行框包含一行表格单元。表中的所有行框按其在源文档中出现的顺序从上到下地填充表。（表的标题行框和注脚行框有所例外，分别出现在表的最前面和最后面）

- 行组包含多少个行框，该行组框就包含多少个表格单元

- 列框包含一列或多列表格单元。所有列框都按照其出现的顺序依次相邻放置。第一个列框放在左边（对于从左到右读的语言）

- 列组中包含多个列框，该列组框中就包含多个表格单元

- 由文档语言来定义跨行或跨列，每个跨行或跨列的单元格是一个矩形框，这个矩形框的顶行在作为该单元格父元素的行中

- 单元格框不能超出表或行组的最后一个行框

表格单元是矩形，给定表格列中的所有表格单元宽度相等，给定表格行中的所有表格高度相等。

### 表显示值

| 属性 | display |
|:-:|:-|
| 值 | none&#124;inline&#124;block&#124;inline-block&#124;list-item&#124;run-in&#124;table&#124;inline-table&#124;table-row-group&#124;table-header-group&#124;table-footer-group&#124;table-row&#124;table-column-group&#124;table-column&#124;table-cell&#124;table-caption&#124;inherit |
| 初始值 | inline |
| 应用于 | 所有元素 |
| 继承性 | 无 |
| 计算值 | 对于浮动、定位和根元素，计算值可变；否则，根据指定确定 |

[参考第07章](https://github.com/wyhcool/notes/blob/master/Web/CSS%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%973/%E7%AC%AC07%E7%AB%A0.%E5%9F%BA%E6%9C%AC%E8%A7%86%E8%A7%89%E6%A0%BC%E5%BC%8F%E5%8C%96.md#%E6%94%B9%E5%8F%98%E5%85%83%E7%B4%A0%E6%98%BE%E7%A4%BA)

与表相关的值：
- table：指定一个元素定义了块级表，定义了一个生成块框的矩形块。
- inline-table：指定一个元素定义了行内级表，定义了一个生成行内框的矩形块。
- table-row：指定一个元素是一个单元格的行。
- table-row-group：指定一个元素是一个或多个行的组。
- table-header-group：指定一个元素是一个或多个标题行的组。标题行组总是在所有其他行和行组之前显示，在表的总标题之后展示。
- table-footer-group：指定一个元素是一个或多个脚注行的组。脚注行组总是在所有其他行之后显示。
- table-column：指定一个元素是一个单元格的列。
- table-column-group：指定一个元素是一个或多个列的组。
- table-cell：指定一个元素是表中的单个单元格。
- table-caption：定义一个表的总标题。

HTML 元素的一般效果：

| 元素 | 效果 |
|:-|:-|
| table | { display: table; } |
| tr    | { display: table-row; } |
| thead | { display: table-header-group; } |
| tbody | { display: table-row-group; } |
| tfoot | { display: table-footer-group; } |
| col   | { display: table-column; } |
| colgroup | { display: table-column-group; } |
| td, th | { display: table-cell; } |
| caption | { display: table-caption; } |

### 以行为主
CSS 表模型定义为“以行为主(row primacy)”，即假设开发人员创建的标记语言会显式声明行，而列是从单元格行的布局中推导出来的。

### 列
单元格在文档源中是行元素的后代，但同时属于两个上下文（行和列）。

列和列组只能接受 4 种样式：
- border：只有当 border-collapse 属性值为 collapse 时才能为列和列组设置边框，这时，列和列组边框会参与设置各单元格边界边框样式的合并。

- background：只有当单元格及其行有透明背景时，列或列组的背景才可见。

- width：定义了列或列组的最小宽度，列中单元格的内容可能要求列更宽。

- visibility：如果一个列或列组的 visibility 属性值为 collapse 时，则该列或列组中所有单元格都不显示。

### 匿名表对象
标记语言中可能未包含足够的元素，以至于无法按定义充分表示表。CSS 定义了机制，可以将遗漏组件作为匿名对象插入。

匿名对象插入规则：
- 如果一个 table-cell 元素的父元素不是 table-row 元素，则会在该 table-cell元素及其父元素之间插入一个匿名 table-row 对象，所插入的对象将包含该 table-cell 的所有连续兄弟。

- 如果一个 table-row 元素的父元素不是 table、 inline-table、或 table-row-group 元素，则会在该 table-row 元素及其父元素之间插入一个匿名 table 元素，所插入的对象将包含该 table-row 的所有连续兄弟。

- 如果一个 table-column 元素的父元素不是 table、 inline-table、或 table-column-group 元素，则会在该 table-column 元素及其父元素之间插入一个匿名 table 元素。

- 如果一个 table-row-group、table-header-group、table-footer-group、table-column-group 或 table-caption 的父元素不是 table 元素，则会在该元素及其父元素之间插入一个匿名 table 元素。

- 如果一个 table 或 inline-table 元素的子元素不是 table-row-group、table-header-group、table-footer-group、table-column-group 或 table-caption 元素，则在该 table 元素与其子元素之间插入一个匿名 table-row 对象，这个对象将包含该子元素的所有不是 table-row-group、table-header-group、table-footer-group、table-column-group 或 table-caption 元素的连续兄弟。

- 如果一个 table-row-group、table-header-group 或 table-footer-group 元素的子元素不是 table-row 元素时，则在该元素及其子元素之间插入一个匿名 table-row 对象，这个对象将包含该子元素的所有本身非 table-row 元素的连续兄弟。

- 如果一个 table-row 元素的子元素不是 table-cell 元素，则在该元素和其子元素之间插入一个匿名 table-cell 对象，这个对象将包含该子元素的所有本身非 table-cell 元素的连续兄弟。

### 表层
为了完成表的显示，CSS 定义了 6 个不同的层，用以分别放表的不同方面。从上到下，依次为单元格（顶层）、行、行组、列、列组、表（底层），对应表各个方面的样式都将在其各自的层上绘制。

注意：列样式在行样式的下面，所以行背景会覆盖列背景。

默认地，所有元素背景都是透明的。如果单元格、行、列等都没有自己的背景，table 元素的背景将透过这些内容不元素可见。

### 表标题
CSS 规范指出，表标题格式化就好像它是直接放在表框之前（或之后）的一个块框，两点不同：
- 表标题仍能从表继承值
- 用户代理在考虑如何处理表前面的 run-in 元素时会忽略表标题框

| 属性 | caption-side |
|:-:|:-|
| 值 | top&#124;bottom |
| 初始值 | top |
| 应用于 | display 值为 table-caption 的元素 |
| 继承性 | 有 |
| 计算值 | 根据指定确定 |

caption 元素中的文本会从 table 继承了 color，但 caption 有自己的背景，caption 的下外边距与 table 的上外边距合并，caption 的宽度要基于 table 元素的内容宽度，这是 caption 的包含块。

大多数情况下，为 caption 应用样式类似于块级元素。

## 表单元格边框
CSS 中有两种截然不同的边框模型，如果单元格相互之间是分隔的，就是分隔边框模型（默认模型）；如果单元格之间没有可见的间隔，单元格边框会相互合并，就是合并边框模型。

| 属性 | border-collapse |
|:-:|:-|
| 值 | collapse&#124;separate&#124;inherit |
| 初始值 | separate |
| 应用于 | display 值为 table 或 inline-table 的元素 |
| 继承性 | 有 |
| 计算值 | 根据指定确定 |

使用属性 border-collapse 值设置为 collapse 时，则使用合并边框模型；设置为 separate 时，就会使用分隔边框模型。

### 分隔单元格边框
表中的每个单元格都与其他单元格分开一定距离，而且单元格的边框彼此不会合并。

#### 边框间隔
利用属性 border-spacing 完全可以替换 HTML 属性 cellspacing。

| 属性 | border-spacing |
|:-:|:-|
| 值 | <length\><length\>?&#124;inherit |
| 初始值 | 0 |
| 应用于 | display 值为 table 或 inline-table 的元素 |
| 继承性 | 有 |
| 计算值 | 两个绝对长度 |
| 说明 | 除非 border-collapse 值为 separate，否则会忽略该属性 |

如果提供两个长度值，则要求第一个值始终是水平间隔，第二个值始终是垂直间隔。

如果要声明一个 border-spacing 值，这回应用于表本身，而不是单个的单元格。

在分隔边框模型中，不能为行、行组、列和列组设置边框。

#### 处理空单元格
如果一个单元格包含有内容，则不是空的。内容包括文本、图像、表单元素等、还包括不可分空间实体(\&nbsp;)和除过 CR（会车）、LF（换行）、tab 和 空格符以外的所有其他空白符。

| 属性 | empty-cells |
|:-:|:-|
| 值 | show&#124;hide&#124;inherit |
| 初始值 | show |
| 应用于 | display 值为 table-cell 的元素 |
| 继承性 | 有 |
| 计算值 | 根据指定确定 |
| 说明 | 除非 border-collapse 值为 separate，否则会忽略该属性 |

设置 empty-cells 值为 show，会画出空单元格的边框和背景，就好像这些单元格有内容一样。

设置 empty-cells 值为 hide，则不会画出该单元格的任何部分，就好像这些单元格被设置为 visibility：hidden。

如果一行中的所有单元格都为空，而且 empty-cells 值都是 hide，则整行将处理为好像这个行元素设置为 display：none。

### 合并单元格边框
合并单元格边框与分隔单元框边框的区别：
- display 值为 table 或 inline-table 的元素不能有任何内边距，可以由外边距。因此，表的外围边框与其最外单元格的边界之间不会有任何间隔。

- 边框可以应用到单元格、行、行组、列、列组。表元素本身通常有一个边框。

- 单元格边框之间绝对不会有任何间隔。如果边框相邻，就会相互合并。

- 一旦合并，单元格之间的边框会在单元格间的假想表格线上居中。

#### 合并边框模型
模型定义，外边框超出了表的宽度，宽度只包含表边框的一半，另一半在此距离之外，落在外边距中。

布局公式：
```javascript
row width = (0.5*border-width0)+padding-left1+width1+padding-right1+border-width1+padding-left2+...padding-rightn+(0.5*border-widthn);
```
其中 border-widthi是指单元格 i 与下一个单元格之间的边框。

用户代理为表本身计算一个初始左右边框的过程：
- 检查表中第一行第一个单元格的左边框，并取该边框宽度的一半作为表的初始左边框宽度；
- 用户代理再检查第一行最后一个单元格的有边框，取其宽度的一半来设置表的初始右边框宽度；
- 对于第一行之后的其他行，如果其左或右边框比初始边框更宽时，则会延伸到表的外边距中。

#### 边框合并
边框合并规则：
- 如果某个合并边框的 border-style 为 hidden，它会优先于所有其他合并边框。这个位置上的所有边框都隐藏。

- 如果某个合并边框的 border-style 为 none（默认值），它的优先级最低，除非所有其他合并边框的 border-style 都是 none，则该位置不会画出该边框。

- 如果至少有一个合并边框的 border-style 不是 none，且所有合并边框的 border-style 都不是 hidden 时，则窄边框不敌宽边框。如果多个合并边框有相同的宽度，则考虑边框样式（优先级降序）：double、solid、dashed、dotted、ridge、outset、groove、inset。

- 如果合并边框的样式和宽度都一样，则按下表顺序使用元素的角色（优先级降序）：cell、row、row-group、column、column-group、table。如果合并边框来自相同类型的元素，则颜色取最上最左边框的颜色（假设从左到右的语言）。


## 表大小

### 宽度
表的宽度有两种不同的方法：固定宽度布局和自动宽度布局，不管何种宽度算法，高度都会自动计算。使用固定宽度布局时，用户代理可以更快地计算出表的布局。

| 属性 | table-layout |
|:-:|:-|
| 值 | auto&#124;fixed&#124;inherit |
| 初始值 | auto |
| 应用于 | display 值为 table 或 inline-table 的元素 |
| 继承性 | 有 |
| 计算值 | 根据指定确定 |

#### 固定布局
固定布局不依赖于表单元格的内容，其布局是根据该表以及表中列和单元格的 width 值决定的。

实现步骤：
- width 属性值不是 auto 的所有列元素都会根据 width 值设置该列的宽度；
- 如果一个列的宽度为 auto，而表首行中位于该列的单元格的宽度不是 auto，则会根据该单元格宽度来设置此列的宽度。如果这个单元格跨多列，则宽度在这些列上平均分配；
- 在上两步之后，如果列的宽度仍为 auto，会自动确定其大小，使其宽度尽可能相等。

此时，表的宽度设置为表的宽度或列宽度之和（取其中较大者）。如果表宽度大于其列宽总和，将二者之差除以列数，分别把这个结果加到每一列上。

所有列宽度都由表的第一行定义，其后所有行中的单元格指定的 width 会被忽略，不会改变列宽。如果一个单元格的内容无法放下，让单元格的 overflow 值将决定单元格内容是裁剪还是生成滚动条。

#### 自动布局
设置表的 width 为 auto 时会触发使用自动布局模型。

自动布局要求用户代理每得到一个新单元格时都完成整个表的局部，通常需要用户代理先完成一些计算，然后再返回头来对表完成第二组计算。必须充分分析单元格的内容，表布局完全取决于单元格的内容。必须计算每个单元格的宽度，而且在确定表的布局之前还必须做一些调整，这有可能触发另一轮宽度计算。

首先确定各列可能宽度的实现步骤：
- 对于一列中的每个单元格，计算最小和最大单元格宽度。
  - 确定显示内容的最小宽度。内容可以流入多行，但不能超出单元格框。如果单元格的 width 值大于最小可能宽度，则把最小宽度设置为该 width 值。如果单元格的 width 值为 auto，最小单元格宽度则设置为最小内容宽度。
  - 确定最大宽度。要确定完全显示内容而且不包括换行所需要的宽度，这个值就是最大单元格宽度。

- 对于每一列，计算最小和最大列宽。
  - 列的最小宽度由该列中所有单元格的最小单元格宽度的最大值确定。
  - 列的最大宽度由该列中所有单元格的最大单元格宽度的最大值确定。

- 如果一个单元格跨多列，最小列宽之和必须等于这个列跨单元格的最小单元格宽度。最大列宽之和必须等于跨列单元格的最大宽度。

<em>如果一个列的 width 值为百分数，这个百分数要相对于表的宽度计算，即便还不知道这个宽度是多少？它必须把这个百分数保存起来，在算法的下一部分使用</em>

再次确定表的宽度步骤：
- 如果表的计算宽度值不是 auto，将这个计算表宽度值与所有列宽再加上所有边框和单元格间隔之和相比较，二者中较大项就是表的最终宽度。如果计算宽度值较大时，所有列的宽度都会增加一个相等的量，使得刚好表完全填充。

- 如果表的计算宽度值为 auto，通过将列宽、边框和单元格间隔相加来确定表的最终宽度，使表的宽度只能恰好显示其内容，而不能有多余。

### 高度
如果表的高度是 auto，其高度是由表中的所有行的高度再加上所有边框和单元格间隔的总和。这与用户代理确定列宽的过程类似。

尽量避免设置高度。

### 对齐
一个单元格的内容水平对齐，使用 text-align 属性。

要将一个表单元格的内容垂直对齐，可以使用  vertical-align 属性：
- top：单元格内容的顶端与行顶端对齐；跨行单元格内容的顶端与其所跨第一行的顶端对齐。

- bottom：单元格内容的顶端与行底端对齐；跨行单元格内容底端与其所跨最后一行的底端对齐。

- middle：单元格内容的中间与行中间对齐；跨行单元格内容的中间与其所跨行的中间对齐。

- baseline：单元格的基线与其行的基线对齐，跨行单元格的基线与所跨的第一行的基线对齐。

行的基线由该行所有单元格中最低初始单元格基线定义。

一行中的单元格内容垂直对齐过程：
- 如果某些单元格是基线对齐，则确定该行的基线，并放置这些基线对齐单元格的内容；
- 放置所有顶端对齐单元格的内容，行现在已有了临时高度，由已经放置了内容的单元格的最低单元格底端确定；
- 如果剩下的单元格是居中对齐或底端对齐，而且内容高度大于临时行高，行高则增加到可以包含其中最高的单元格；
- 放置所有余下单元格的内容。如果单元格内容的高度比行高小，则增加单元格的内边距使之适应。


## 参考
[1] Meyer E , 迈耶, Meyer. CSS权威指南[M]. 东南大学出版社, 2007.