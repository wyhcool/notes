---
title: 【布局】浮动和定位
date: 2019-02-13 21:21:00
tags:
categories:
- CSS
---

## 浮动
CSS 允许浮动任何元素。

| 属性 | float |
|:-:|:-|
| 值 | left&#124;right&#124;none&#124;inherit |
| 初始值 | none |
| 应用于 | 所有元素 |
| 继承性 | 无 |
| 计算值 | 根据指定确定 |

### 浮动元素
浮动元素将会以某种方式从文档的正常流中删除，且几乎自成一派，但还是对文档的其余部分有影响。

一个元素浮动时，其他内容会环绕该元素。

浮动元素周围的外边距不会合并。

如果要浮动一个非替换元素，根据 CSS 规范，元素的宽度趋于0，则必须为该元素声明一个 width。（用户代理实际则不然）

### 不浮动
设置 float: none 用于防止元素浮动。在需要清除元素的浮动时添加。

### 浮动的详细内幕
浮动元素的包含块(containning block)是其最近的块级祖先元素。

浮动元素会生成一个块级框，而不论这个元素本身是什么。即使该元素本身是行内框，通常会生成一个行内框，但只要它是浮动的，就会生成一个块级框。

控制浮动元素的规则：
- 左浮动元素的左边界向左最远只能到其包含块的左内边界，类似地，右浮动元素的右边界向右最远只能到达其包含块的右内边界。

- 左浮动元素的左边界必须是源文档中之前出现的左浮动元素的右边界，除非后出现的浮动元素的顶端在先出现的浮动元素的底端之下。类似地，右浮动元素的右边界必须是源文档中之前出现的右浮动元素的左边界。（防止同向浮动元素彼此覆盖，使得所有浮动内容都是可见的）

- 左浮动元素的右边界不会出现在右浮动元素的左边界的右边。类似地，右浮动元素的左边界不会出现在左浮动元素的右边界的左边。（防止反向浮动元素彼此覆盖，将后浮动的元素置于前浮动元素的底端之下）

- 一个浮动元素的顶端不能比其父元素的内顶端更高。（限制上浮，防止浮动元素一直浮动到文档的顶端）如果一个浮动元素在两个合并外边距之间，放置这个浮动元素时就好像在这两个元素之间有一个块级元素。

```html
<div>
    <p>P1</p>
    <p>P2</p>
    <p>P3</p>
</div>

<div>
    <p>P1</p>
    <p style="float:left;">P2</p>
    <p>P3</p>
</div>
```

- 浮动元素的顶端不能比之前出现的所有浮动元素或块级元素的顶端更高。（进一步限制上浮，使浮动元素总在其之前浮动元素的下面）

- 如果源文档中一个浮动元素之前出现另一个元素，该浮动元素的顶端不能比包含该元素所生成的行框的顶端更高。（更进一步限制上浮，使浮动元素在其上下文内）

- 左浮动元素的左边有另一浮动元素，前者的右边界不能在其包含块的右边界的右边。类似地，右浮动元素的右边有另一浮动元素，前者的左边界不能在其包含块的左边界的左边。（浮动元素不能超出其包含元素的边界，除非它太宽，本身都无法放下。如果浮动元素出现在另一个浮动元素的旁边时，若因此导致超出包含块的话，没有足够的空间，这个浮动元素就会向下浮动到之前浮动元素下面，即挤到一个新行上）

- 在满足其他约束条件的前提下，浮动元素必须尽可能高地放置。

- 在满足其他约束条件的前提下，左浮动元素必须向左尽可能远，右浮动元素必须向右尽可能远。位置越高，就会向左或向右浮动得越远。

### 浮动的实用行为

#### 浮动元素比父元素高
浮动元素会超出其父元素的底端。

<em>浮动元素会延伸，从而包含其所有后代浮动元素。通过将父元素置为浮动元素，就可以把浮动元素包含在父元素内。</em>

浮动元素同时处于流内和流外。

#### 负外边距
负外边距可能导致浮动元素移到其父元素的外面。

### 浮动元素、内容和重叠
如果一个浮动元素与正常流中的内容发生重叠时：
- 行内框：其边框、背景和内容都在该浮动元素之上显示；
- 块框：其边框、背景在该浮动元素之下显示，其内容在浮动元素之上显示。

### 清除浮动
在页面布局时，不总是希望内容流过浮动元素，可能需要特意避免这种行为。

| 属性 | clear |
|:-:|:-|
| 值 | left&#124;right&#124;both&#124;none&#124;inherit |
| 初始值 | none |
| 应用于 | 块级元素 |
| 继承性 | 无 |
| 计算值 | 根据指定确定 |

```css
h3 { clear: left }
```
解释为：确保所有 h3 的左边没有浮动元素。

clear: none 允许元素浮动到另一个元素的任意两边。


## 定位
利用定位，可以准确地定义元素框相对于正常位置应该出现在哪里，或者相对于父元素、另一个元素甚至是浏览器窗口本身的位置。

### 定位类型

| 属性 | position |
|:-:|:-|
| 值 | static&#124;relative&#124;absolute&#124;fixed&#124;inherit |
| 初始值 | static |
| 应用于 | 所有元素 |
| 继承性 | 无 |
| 计算值 | 根据指定确定 |

使用 position 属性：

- static：元素框正常生成。块级元素生成一个矩形框，作为文档流的一部分，行内元素则会创建一个或多个行框，置于其父元素中。

- relative：元素框偏移某个距离。元素仍然保持其未定位前的形状，它原本所占的空间仍保留。

- absolute：元素框从文档流中完全删除，并相对于其包含块定位，包含块可能是文档中的另一个元素或者是初始包含块。元素原先在正常文档流中所占的空间会关闭，就好像该元素从来不存在一样。元素定位后生成一个块框，而不论原来它在正常流中生成何种类型的框。

- fixed：元素框的表现类似于 absolute，不过其包含块是视窗本身。

### 包含块（定位上下文）
定位行为：

- 根元素的包含块（即初始包含块）由用户代理建立。在 HTML 中，根元素就是 html 元素。初始包含块是一个视窗大小的矩形。

- 对于一个非根元素，如果其 position 值是 relative 或 static，包含块则由最近的块级框、表单元格、行内块祖先框的内容边界构成。

- 对于一个非根元素，如果其 position 值是 absolute，包含块设置为最近的 position 值不是 static 的祖先元素（可以是任何类型），过程如下：
  - 如果祖先是块级元素，包含块则设置为该元素的内边距边界，即边框界定的区域；
  - 如果祖先是行内元素，包含块则设置为该元素的内容边界。在从左向右读的语言中，包含块的上边界和左边界是该祖先元素的第一框内容区的上边界和左边界，包含块的下边界和右边界是最后一个框内容区的下边界和右边界。
  - 如果没有祖先，元素的包含块定义为初始包含块。

### 偏移属性

| 属性 | top、right、bottom、left |
|:-:|:-|
| 值 | <length\>&#124;<percentage\>&#124;auto&#124;inherit |
| 初始值 | auto |
| 应用于 | 定位元素，即 position 值不是 static 的元素 |
| 继承性 | 无 |
| 百分数 | 对于 top 和 bottom，相对于包含块的高度；对于 right 和 left，相对于包含块的宽度 |
| 计算值 | 对于 static 元素为 auto；对于长度值，是绝对长度；对于百分数值，则为指定的值 |

描述定位元素各边相对于其包含块的最近边的偏移(offset)，而不是距包含块左上角的偏移。比如，top 描述了定位元素上外边距边界离包含块的顶端多远。

### 宽度和高度
对于定位元素而言不一定必要设置一个元素的宽度和高度。如果使用 top、right、bottom、left 来描述元素 4 个边的放置位置，那么元素的高度和宽度将由这些偏移隐含确定。

若向元素增加了外边距、边框或内边距，如果此时为 height 和 width 显式指定值，可能使定位元素延伸超出包含块。

### 限制宽度和高度
为元素的内容区定义一个最大最小尺寸。

| 属性 | min-width、min-height |
|:-:|:-|
| 值 | <length\>&#124;<percentage\>&#124;inherit |
| 初始值 | 0 |
| 应用于 | 除了非替换行内元素和表元素之外的所有元素 |
| 继承性 | 无 |
| 百分数 | min-width 相对于包含块的宽度，min-height 相对于包含块的高度 |
| 计算值 | 对于百分数，根据指定确定；对于长度值，则为绝对长度；否则，none |

| 属性 | max-width、max-height |
|:-:|:-|
| 值 | <length\>&#124;<percentage\>&#124;inherit |
| 初始值 | 0 |
| 应用于 | 除了非替换行内元素和表元素之外的所有元素 |
| 继承性 | 无 |
| 百分数 | max-width 相对于包含块的宽度，max-height 相对于包含块的高度 |
| 计算值 | 对于百分数，根据指定确定；对于长度值，则为绝对长度；否则，none |

最大最小属性的一个最大的好处是：可以相对安全地混合使用不同的单位。

### 内容溢出
如果一个元素的内容对于元素大小来说过大，就有可能溢出元素本身。

一个元素固定为某个特定大小时，但内容在元素中放不下，此时可以利用 overflow 属性来控制。

| 属性 | overflow |
|:-:|:-|
| 值 | visible&#124;hidden&#124;scroll&#124;auto&#124;inherit |
| 初始值 | visible |
| 应用于 | 块级元素和替换元素 |
| 继承性 | 无 |
| 计算值 | 根据指定确定 |

默认值 visible 表明，元素的内容在元素框之外也可见。一般地，这会导致内容超出其自身的元素框，但不会改变框的形状。

如果 overflow 设置为 scroll，元素的内容会在元素框的边界处剪裁，溢出部分通过提供某种滚动机制来查看。

如果 overflow 设置为 hidden，元素的内容会在元素框的边界处剪裁，不会提供滚动接口使用户访问超出剪裁区域的内容。

如果 overflow 设置为 auto，如果元素的内容超出其自身的元素框，会在元素框的边界处剪裁，溢出部分通过提供某种滚动机制来查看。

### 内容剪裁
如果一个绝对定位元素的内容溢出内容框，而且 overflow 设置为要求剪裁该内容，通过使用属性 clip 可以改变剪裁区域的形状。

| 属性 | clip |
|:-:|:-|
| 值 | rect(top, right, bottom, left)&#124;auto&#124;inherit |
| 初始值 | auto |
| 应用于 | 绝对定位元素 |
| 继承性 | 无 |
| 计算值 | 对于矩形，4个计算长度表示剪裁矩形区域的4个边；否则，根据指定确定 |

默认值 auto 表示元素的内容不应剪裁。

rect(...) 的值不是边偏移，而是距元素左上角的偏移（从左到右读的语言）。如果设置为 auto，这相当于将剪裁边界设置为适当的内容边界。

### 元素可见性

| 属性 | visibility |
|:-:|:-|
| 值 | visible&#124;hidden&#124;collapse&#124;inherit |
| 初始值 | visible |
| 应用于 | 所有元素 |
| 继承性 | 有 |
| 计算值 | 根据指定确定 |

如果 visibility 设置为 hidden，则会置为不可见，处于不可见状态时，元素还是会影响文档的布局，就好像它还可见一样。换言之，元素还在那里，只不过你看不见它。

设置 display：none，元素不仅不显示，还会从文档中删除，所以对文档布局没有任何影响。

### 绝对定位
元素绝对定位时，会从文档中完全删除，然后相对于其包含块定位，其边界根据偏移属性放置。

绝对定位的元素不会流入其他元素的内容，可以覆盖其他元素，亦可被其他元素覆盖。

绝对定位元素的包含块为最近的 position 值不为 static 的祖先元素。开发者通常会选择一个元素作为绝对定位元素的包含块，将其 position 指定为 relative 而且没有偏移。

元素绝对定位时，还会为其后代元素建立一个包含块。

如果文档可滚动，定位元素会随着它滚动。只要绝对定位元素不是固定定位元素的后代。

#### 绝对定位元素的放置和大小
未显式设置宽高时，根据偏移属性来确定元素的宽高。

#### 自动边偏移
元素绝对定位时，如果除 bottom 外某个任意偏移属性设置为 auto，会有一种特殊的行为。

如果 top 设置为 auto，定位元素的顶端要相对于未定位前本来的顶端位置对齐。即假设元素的 position 值为 static ，也就是计算出的其顶边应在的位置。

元素的静态位置(static position)：元素在正常流中原本的位置。顶端的静态位置是从包含块的上边界到假想框的上外边距边界之间的距离。如果这个假想的元素框在包含块的上面，则这个值为负。

绝对定位一个元素，与其静态位置一致。

```html
<p>
 When we consider the effect of positioning, it quickly becomes clear that authors
 can do a great deal of damage to layout, just as they can do very interesting
 things.<span style="position: absolute; top: auto; left: 0;">[4]非同一个预估一个</span>
 This is usually the case with useful technologies: the sword always has
 at least two edges, both of them sharp.
 </p>


<p>
 When we consider the effect of positioning, it quickly becomes clear that authors
 can do a great deal of damage to layout, just as they can do very interesting
 things.<span style="position: absolute; top: auto; left: auto;">[4]非同一个预估一个</span>
 This is usually the case with useful technologies: the sword always has
 at least two edges, both of them sharp.
 </p>

<p>
 When we consider the effect of positioning, it quickly becomes clear that authors
 can do a great deal of damage to layout, just as they can do very interesting
 things.<span style="position: static">[4]非同一个预估一个</span>
 This is usually the case with useful technologies: the sword always has
 at least two edges, both of them sharp.
 </p>


<p>
 When we consider the effect of positioning, it quickly becomes clear that authors
 can do a great deal of damage to layout, just as they can do very interesting
 things.<span style="position: absolute; top: auto; left: auto; right: 0;
 bottom: 0; height: 2em; width: 5em;">[4]非同一个预估一个</span>  This is usually the case with
 useful technologies: the sword always has at least two edges, both of them sharp.
 </p>
```
自动放置只有在某些情况下可行：通常对定位元素的尺寸没有限制时。对其宽度和高度没有限制，对下边界和右边界的放置也没有限制。

#### 非替换元素的放置和大小
一般地，元素的大小和位置取决于包含块。考虑一个定位元素的宽度和水平位置：

```javascript
包含块的 width = left + margin-left + border-left-width + padding-left + width + padding-right + border-right-width + margin-right;
```

这些属性之间的关系：
- left、width 和 right 都设置为 auto，此时左边界置于其静态位置（假设使用从左到右读的语言），元素的 width 设置为收放得正好合适，即该元素的内容区宽度恰好只能包含其内容，而没有更多空间。（“恰当收放”）

- margin-left 和 margin-right 都设置为 auto，而 left、width 和 right 不是 auto，此时左右外边距会设置为相等的值，让元素居中。

- 所有属性设置都不是 auto，过度受限情况下用户代理会忽略并重置 right 的值。（假设使用从左到右读的语言）

- 如果只有一个属性设置为 auto 时，就会修改这个属性来使等式满足。

对于垂直方向上，规则与之类似。差异点：
- 将外边距设置为 auto 的绝对定位元素垂直居中

- 在垂直布局中，只有 top 可以取静态位置， bottom 做不到。

- 如果在垂直方向上过分受限，将忽略 bottom。


#### 替换元素的放置和大小
替换元素和非替换元素的规则大不相同，替换元素有固定的高度和宽度，因此其大小不会改变，除非开发人员显式地修改，因此也没有恰当收放的行为。

确定替换元素的位置和大小规则：
- 如果 width 设置为 auto，width 的实际使用值由元素内容的固有宽度决定，如果显示声明 width，则使用该值。

- 如果 left 值为 auto，要把 auto 替换为静态位置。（假设使用从左到右读的语言）

- 如果 left 或 right 仍为 auto（即上一步中未替换），则将 margin-left 或 margin-right 的所有 auto 值替换为 0。

- 如果 margin-left 和 margin-right 仍为 auto，则将它们设置为相等的值，从而将元素在其包含块中居中。

- 最后，如果只剩下一个 auto值，则修改这个属性来使等式满足。

过度受限情况下用户代理会忽略并重置 right 的值。（假设使用从左到右读的语言）

对于垂直方向上，规则与之类似。

#### z轴上的放置

| 属性 | z-index |
|:-:|:-|
| 值 | <integer\>&#124;auto&#124;inherit |
| 初始值 | auto |
| 应用于 | 定位元素 |
| 继承性 | 无 |
| 计算值 | 根据指定确定 |

使用 z-index 可以改变元素相互覆盖的顺序。有较高的 z-index 值的元素离用户更近，这就导致有较高 z-index 值的元素覆盖其他元素。

所有整数都可以用作 z-index 的值，包括负数。

一旦为元素指定了 z-index 值（非 auto ），该元素就会建立自己的布局叠放上下文，即元素的所有后代相对于该祖先元素都有自己的叠放顺序，而且该元素位于此上下文 z 轴的 0 位置上。

将元素设置为 z-index： auto，表示当前叠放上下文中生成框的栈层次与其父框相同，该框不会建立新的局部叠放上下文。

叠放规则要求：元素绝对不会叠放在其叠放上下文的背景之下。

z-index 值为负值时，要小心使用。

### 固定定位
固定定位的包含块是视窗。固定定位时，元素会完全从文档流中取出，不会有相对于文档任何部分的位置。

使用固定定位创建帧式界面；或者在屏幕上放置一个“永久性”元素。

### 相对定位
当元素相对定位时，它会从其正常位置处移走，不过，原来所占的空间并不会因此消失。

过分受限的相对定位，一个值会重置为另一个值的相反数。

## 参考
[1] Meyer E , 迈耶, Meyer. CSS权威指南[M]. 东南大学出版社, 2007.