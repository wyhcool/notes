---
title: 【代码大全2】07 软件工艺 Software craftsmanship
date: 2018-09-10 00:35:09
tags:
categories:
- Programming
---

## 第31章 布局与风格 Layout and style
### 基本原则 Layout foundamentals
格式化的基本原理指出：好的布局凸现程序的逻辑结构。
布局是关于程序结构的有用暗示。计算机可能只关心花括号或begin/end，而人看程序时总倾向于从代码的视觉外观获取提示。
良好布局的目标：
- 准确表现代码的逻辑结构
- 始终如一地表现代码的逻辑结构
- 改善可读性
- 经得起修改

### 布局技术 Layout techniques
#### 空白 White space
空白能增强可读性。空白包括空格、制表符、换行、空行、是展现程序结构的主要手段。
空白也是分组，也是确保相关的语句成组放在一起。
空行是指示一个程序如何组织的手段，可以用空行将相关语句各自划分成段落、分开子程序、突出注释部分。
用缩进形式显示程序的逻辑结构，那些逻辑上隶属于某语句的语句都应缩进。

#### 括号 Parentheses
对包含两个以上的项的表达式，应该用括号去澄清之。

### 布局风格 Layout styles
多数布局问题都涉及到块结构，即跟在控制语句后面的那些语句组。块结构被花括号或关键字括起来。
四种常见的布局风格：
- 纯块结构(pure blocks)。控制结构的开始和结束语句对齐，中间语句整体缩进。

```vb
While pixelColor = Color_Red
    statement1;
    statement2;
Wend
```
- 模仿纯块结构(emulating pure blocks)。 如果所用语言不支持纯块结构，可将关键字 begin/end 或 { 和 } 标记看成是所在控制结构的扩展。这种风格在 Java 中是标准，在 C++ 里用得很普遍。

```c++
if ( pixelColor == Color_Red ) {
    statement1;
    statement2;
}

while ( pixelColor == Color_Red ) {
    statement1;
    statement2;
}

switch ( pixelColor ) {
    case Color_Red:
        statement1;
        statement2;
    break;
    case Color_Blue:
        statement1;
        statement2;
    break;
    default:
        statement1;
        statement2;
    break;
}
```
- 使用 begin-end 对(花括号)指定块边界。begin 和 end 视为控制结构下的语句，而非控制语句的一部分。

```
if ( pixelColor == Color_Red ) 
    {
    statement1;
    statement2;
    }

while ( pixelColor == Color_Red ) 
    {
    statement1;
    statement2;
    }

switch ( pixelColor ) 
    {
    case Color_Red:
        statement1;
        statement2;
        break;
    case Color_Blue:
        statement1;
        statement2;
        break;
    default:
        statement1;
        statement2;
        break;
    }
//switch/case 语句中关键字 break 代替右括号，而左括号没有等价表示
```
- 行尾布局(endline layout)，即一大组代码缩进至行中间或结尾的布局策略。

### 控制结构的布局 Laying out control structures
格式化控制的要点：**使用模仿纯块结构或将begin-end作为块边界，并将其间语句对齐的布局风格之一来改进格式**。
- 不要用未缩进的 begin-end 对。

```java
for ( int i = 0; i < MAX_LINES; i++ ) 
{
    ReadLine( i );
    ProcessLine ( i );
}
//没能显示出代码的逻辑结构，begin 和 end 既不是控制结构的一部分，又不是其后语句的一部分。
```
- 别让 begin 和 end 两次缩进。

```java
for ( int i = 0; i < MAX_LINES; i++ ) 
    {
        ReadLine( i );
        ProcessLine ( i );
    }
//两次缩进扩大了程序逻辑结构的复杂度
```
- 段落之间要使用空行
- 单语句代码块的格式要前后统一
- 对于复杂的表达式，将条件分隔放在几行上
- 不用 goto
- case 语句不要有行尾布局的例外

### 单条语句的布局 Laying out individual statements
#### 语句长度 Statement length
语句长度应限制在 80 个字符以内。

#### 用空格使语句显得清楚 Using space for clarity
- 使用空格让逻辑表达式更易读
- 使用空格让数组引用更容易读
- 使用空格让子程序参数更容易读

#### 格式化后续行 Formatting continuation lines
- 使续行明显。将第一行部分做成若其单独存在时就有明显错误的形式 或者 将后续字符置于后续行的开头
- 把紧密关联的元素放在一起
- 将子程序调用的后续行按标准量缩进
- 让续行的结尾易于发现
- 将控制语句的后续行按标准量缩进
- **不要将赋值语句按等号对齐**
- 对赋值语句后续行按标准量缩进

#### 每行仅写一条语句 Using only one statement per line
不要让一行里有多个操作，导致副作用，即语句除了主要结果之外还有其他效用。

```c
//一行上有过多操作
strcpy ( char * t, char * s ) {
    while ( *++t = *++s )
        ;
}

//把各操作放在各自的行中，改善可读性
strcpy ( char * t, char * s ) {
    do {
        ++t;
        ++s;
        *t = *s;
    } 
    while ( *t != '\0');
}

//性能的改善并不靠将多个操作置于一行来实现
```

#### 数据声明的布局 Laying out data declarations
- 每行只声明一个数据
- 变量声明应尽量接近其首次使用的位置
- 合理组织声明顺序
- 声明指针变量，把星号靠近变量名，或者去声明指针类型。若将星号写在类型名而非变量名旁边的问题是：如果一行上有多个声明，星号只作用于第一个变量。最好的办法是先声明指针类型名，再用类型名来声明变量。

### 注释的布局 Laying out comments
- 注释的缩进要与相应代码一致
- 每行注释用至少一个空行分开

### 子程序的布局 Laying out routines
- 用空行来分隔子程序的各部分。在子程序的头、数据和常量名声明、子程序体之间插入空行
- 将子程序参数按标准缩进

### 类的布局 Laying out classes
#### 类接口的布局 Laying out class interfaces
- 说明类及其完整用法的头部注释
- 构造函数和析构函数
- public 子程序
- protected 子程序
- private 子程序和数据成员

#### 类实现的布局 Laying out class implementations
类实现通常按如下顺序排布：
- 描述类所在文件的内容的头部注释
- 类数据
- public 子程序
- protected 子程序
- private 子程序

如果文件包含多个类，要清楚地标出每个类。
不要在类里过度注释。

#### 文件和程序布局 laying out files and programs
- 一个文件应只有一个类
- 文件的命名应与类名有关
- 在文件中清晰地分隔各子程序

对于 C++ 源文件内容的典型顺序应为：
- 文件的描述性注释
- #include 文件行
- 在多个类里使用的常量定义（如果文件里有多个类）
- 在多个类里使用的枚举（如果文件里有多个类）
- 宏函数定义
- 在多个类里使用的类型定义（如果文件里有多个类）
- 导入的全局变量和函数
- 导出的全局变量和函数
- 本文件私用的变量和函数
- 各个类，包括各个类的常量定义、枚举以及类型定义


## 第32章 自说明代码 Self-documenting code
### 外部文档 External documentation
软件项目的文档涵盖了源码清单内外的各种信息。外部文档包括：
- 单元开发文件夹(unit-development folder, UDF)。其中包含了供开发者在编程期间使用的记录，主要用途是提供在其他地方没有说明的设计决策踪迹。
- 详细设计文档。详细设计文档是低层次的设计文档，描述在类层或子程序层的设计决定，曾考虑过的其他方案，以及采用所选方案的理由。

### 编程风格作文档(内部文档) Programming style as documentation
内部文档嵌入于程序清单本身，是最详细的文档，位于源代码层次上。在代码层文档中起主要作用的因素并非注释，而是好的编程风格。
好的编程风格包括：
- 良好的程序结构
- 直率易懂的方法
- 有意义的变量名和子程序名
- 具名常量（而非文字量）
- 清晰的布局
- 最低复杂度的控制流和数据结构

易读性的最高水平：自说明代码。这些代码通过好的编程风格承担文档说明的很大一部分任务。对于精心编写的代码而言，注释不过是美丽衣裳上的小饰物而已。

### 注释或不注释 To comment or not to comment
**写注释能让你更好地思考代码在干什么。如果注释困难，要么是因为代码差劲，要么是没有理解透彻代码。不管怎样，都得对代码再花时间。所以写注释并非是在做无用功，而是指出你该做的工作**。

### 高效注释的关键 Keys of effective comments
#### 注释种类 Kinds of comments
- 重复代码。重复性注释只是用不同文字把代码的工作又描述一次，除了给读者增加阅读量外，没有提供更多信息。
- 解释代码。解释性代码通常用于解释复杂、敏感的代码块，通常因为代码含混不清，才体现出这类注释的价值。如果代码过于复杂而需要解释，最好是改进代码。
- 代码标记。标记性注释意在提醒开发者某处的工作未做完，有必要规范标记型注释的风格，比如使用 TODO。
- 概述代码。概述性注释将若干代码行的意思用一两句话说出来，指出解决方案。
- 代码意图说明。目的性注释用来说明一段代码的意图，指出要解决的问题，而非解决的方法。
- 传达代码无法表述的信息。这种注释包括版权声明、保密要求、版本号等杂项信息；与代码设计有关的注意事项；相关要求或架构文件的索引；联机参考链接；优化注记；或Javadoc 等编辑器要求有的注释。

对于完工的代码，只允许有的三种注释类型：代码无法表述的信息、目的性注释和概述性注释。

#### 高效注释 Commenting efficiently
- 采用不会打断或抑制修改的风格。任何太具想象力的风格维护起来都会很烦人。
- 用伪代码编程法减少注释时间

#### 最佳注释量 Optimum number of comment
约每十条语句有一个注释，这样的密度时程序清晰度最高。

### 注释技术 Commenting techinques
依据注释所在的层次——程序、文件、子程序或单独行，有若干种不同的注释技术。
#### 注释单行 Commenting individual lines
注释一行代码的理由：
- 该行代码太复杂，因而需要解释
- 该行语句出过错，你想记下这个错

单行注释的指导原则：
- 不要随意添加无关注释。
- 不要对单行代码做行尾注释。行尾注释带来编排和维护困难。
- 不要对多行代码做行尾注释。

#### 注释代码段 Commenting paragraphs of code
- 注释应表达代码的意图
- 代码本身应该尽力做好说明
- 注释代码时应注重“为何做(why)”而不是“怎么做(how)”。说明“怎么做”的注释一般停留在编程语言的层次，而不是为了说明问题。
- 用注释为后面的内容做铺垫
- 让每个注释都有用
- 说明非常规做法
- 别用缩略语。注释不应该有歧义。
- 将主次注释区分开。好的办法是：在次注释前加入省略号，主注释以普通方式编排。
- 错误或语言环境独特点要加注释
- 给出违背良好编程风格的理由
- 不要注释投机取巧的代码，应重写之。对投机取巧的代码注释是错误的，注释不应帮扶难度大的代码。“不要注释糟糕的代码——应重写之”。

#### 注释数据声明 Commenting data declarations
变量声明的注释应给出变量名未表达出来的各种信息。**对数据注释比对使用数据的过程做注释更重要**。注释数据的指导原则：
- 注释数值单位。替代做法是：很多情况下将单位写进变量名，而不再用注释。
- 对数值的允许范围给出注释。
- 注释编码含义。
- 注释对输入数据的限制。ASSERT 断言是另一种说明有效范围的方法，使用断言可以让代码更具自检能力。
- 注释“位标志”。对每个数据位的含义做出说明。
- 将与变量有关的注释通过变量名联系起来。方便查找。
- 注释全局数据。要在其声明处做出注释，指出该数据的目的、为何必须是全局数据。好的命名规范是凸显变量全局性的首选办法。

#### 注释控制结构 Commenting control structures
- 应在每个 if、case、循环或者代码段前面加上注释。注释起到阐明控制结构意图的作用。
- 应在每个控制结构后加上注释。可以使用注释标明嵌套，为代码缩进所给出的逻辑结构补充了视觉线索。

#### 注释子程序 Commenting routines
- 注释应靠近其说明的代码。子程序不该有庞大的注释头，遵循靠近原则，尽可能拉近注释和其说明的代码之间的距离，使其更容易维护，从而持久发挥其作用。
- 在子程序上部用一两句话说明之。所有的子程序都应附概述性注释。
- 在声明参数处注释这些参数。把注释放到各参数声明的后面，这做法是不要用行尾注释的例外，在用来说明输入输出参数时相当有效。
- 用注释标记程序的各部分，利用诸如 Javadoc 之类的代码说明工具。通过其配置代码以便抽取参数说明。
- 分清输入与输出数据
- 注释接口假设
- 对子程序的局限性作注释
- 说明子程序的全局效果。如果子程序会修改全局数据，要确切描述它对全局数据做了些什么。
- 记录所用算法的来源。

#### 注释类、文件和程序 Commenting classes, files, and programs
类、文件、程序的共同特征是都包含多个子程序。注释的任务就要对类、文件、程序的内容提供有意义的概括说明。
##### 标注类的一般原则
- 说明该类的设计方法。说明类的设计思路、总体设计方法、曾经考虑过后又放弃的其他方案等等。
- 说明局限性、用法假设等。
- 注释类接口。类接口应该包含别人使用该类时所需的全部信息。
- 不要在类的接口处说明实现细节。封装的规则是：仅公开那些需要知道的信息。类接口文件中应当只有类的用法信息，而不应有需要实现或维护类内操作的信息。

##### 说明文件的一般原则
在文件开头处用注释块说明文件的内容。
- 说明各文件的意图和内容
- 将姓名、电子邮件放到注释块中
- 在注释块中包含法律通告
- 将文件命名为与内容相关的名字。文件名一般应该与其中的公开类的类名有密切联系。

##### 程序注释以书本为范例
将代码看作一类特殊的书籍，并据此进行编排，可以帮助程序员获得对程序的高层次认识。
- 书的序：类似于文件头注释，起到介绍文件的作用
- 书的目录：类似于顶层文件、类和子程序
- 书的节：类似于子程序内的各单位（子程序声明、数据声明、可执行语句）
- 书的引用：类似于代码的引用


## 第33章 个人性格 Personal character
个人性格对于造就出程序员高手具有决定性意义。

### 聪明与谦虚 Intelligence and humility
大部分编程工作都旨在弥补我们有限的智力。
承认自己智力有限并通过学习来弥补，才有可能成为更好的程序员。
很多好的编程做法都能减轻脑力的负担：
- 将系统分解，使之易于理解
- 进行审查、评审和测试，减少人为失误
- 将子程序编写得短小，以减轻大脑负荷
- 基于问题而不是低层实现细节来编程，从而减少工作量
- 通过各种各样的规范，将思路从相对繁琐的编程事务中解放


### 求知欲 Curiosity
对技术事务的求知欲具有压倒一切的重要性。
培养求知欲和把学习当作第一要务的方法：
- 在开发过程中建立自我意识。你越了解软件开发过程，你就越能理解变化，使团队朝着正确的方法发展。
- 试验。对编程和开发过程做实验，看看它是如何工作的。有效编程的关键之一就是要学会迅速制造错误，并且每次都能从中有所收获。犯错不是罪过，从中学不到什么才是罪过。
- 阅读解决问题的有关方法。**解决问题是软件创造过程中的核心行为**。
- 在行动之前做分析和计划
- 学习成功项目的开发经验。研究高手的程序，读一些好书。
- 向专业开发对齐：
  - 入门级：利用某语言的基本功能，能够编写类、子程序、循环和条件语句，会使用语言的许多特性
  - 中级：能利用多种语言的基本功能，并会得心应手地使用至少一种语言
  - 熟练级：对语言或环境有着专业技能。
  - 技术带头人：具有第三级才能，明白编程工作只有 15% 用来和计算机交互，其余都是与人打交道的。技术带头人会为人写代码，而非机器。


### 诚实 Intellectual honesty
- 不是高手时不假装是高手
- 乐于承认错误
- 力图理解编辑器的警告，而非弃之不理
- 透彻理解自己的程序，而不要只是编译看看能否运行
- **提供实际的状况报告**。上司通常愿意听到对项目状态的真实汇报，以便协调开发活动。
- 提供现实的进度方案，在上司面前坚持自己的意见。**妥协会让人失去信用**。


### 交流与合作 Communication and cooperation
融洽地工作和娱乐。
代码便于看懂是对团队成员的要求之一，编程首先是与人交流，其次才是与计算机交流。

### 创造力与纪律 Creativity and discipline
Form is liberating(形式就是解放)
在非关键处建立规范，在重要处发挥创造力。

### 懒惰 Laziness
懒惰的表现：
- 拖延不喜欢的任务（实在懒）
- 迅速不喜欢的任务，以摆脱之（开明懒）
- 编写某个工具来完成不喜欢的任务，以便再也不用做这样的事情了（一劳永逸懒）

有效编程中最重要的工作是思考。


### 不如你想象中那样起作用的性格因素
#### 坚持
软件开发过程中，当一种办法行不通时，正好换个办法试试。
**知道何时放弃很难，但这是必须要面对的问题**。“要是这种方法三十分钟内还不解决恩梯，我就会画十分钟想些其他办法，再用一个钟头尝试最可行的办法”。

#### 经验
在软件行业中，任何人放松下来就很快跟不上形势。为了让自己有用，你必须紧跟潮流。
只有坚持不懈地学习，才能获取经验；如果不那么做，就无法得到经验，无论你工作多少年。

#### 编程狂人
可以热爱编程，但热情不能代替熟练的能力，请想明白什么更重要。

### 习惯 Habits
行为养成习惯。


## 第34章 软件工艺的话题 Themes in software craftsmanship
### 征服复杂性 Conquer complexity
软件设计与构建的主要目标是：征服复杂度。降低复杂度几乎是衡量程序员成果的最重要的依据。

### 精选开发过程 Pick your process
软件开发与其过程有着很大关系。软件开发是创造性的活动，坏的过程只会损耗脑力，好的过程则能将脑力充分发挥到极致。

### 首先为人写程序，其次才是为机器 Write programs for people first, computers second
编写可读性好的代码，是为了便于别人看懂。自说明代码背后的动机正是出于同别人交流的需要。

### 深入一门语言去编程，不浮于表面 Program into your language, not in it
优秀的程序员会考虑他们要干什么，然后才是怎样用手头的工具去实现他们的目标。

### 借助规范集中注意力 Focus your attention with the help of conventions
规范是一套用于管理复杂度的智力工具。
- 使用规范能避免各程序员随意决定导致的理解困难
- 规范能够精确地传达重要信息
- 规范可以免除各种危险做法
- 规范增加了对低层工作的可预见性
- 规范能够弥补语言的不足之处

应理解规范的真正价值，并充分利用规范，使用规范以提供所需的结构。

### 基于问题域编程 Program in terms of the problem domain
针对编程所要解决的问题来工作，而非针对计算机科学的解决方案。
将程序划分为不同层次的抽象：
- 第0层：操作系统的操作和机器指令。
- 第1层：编程语言结构和工具。编程语言结构即编程语言的基本数据类型、控制结构等。工具即编程语言提供饿了一些库文件、对操作系统调用的访问等。
- 第2层：低层实现结构。数据结构和算法——栈、队列、链表、树、索引文件、顺序文件、排序算法、查找算法等。
- 第3层：低层问题域。这一层次是下层的计算机科学机构和上层问题域代码之间的粘连层。在这一层里需要构思出解决问题的方法，并创建用以解决问题的各种基本构件。
- 第4层：高层问题域。这一层基于问题域的术语提供了对问题工作的抽象能力。这一层并不怎么依赖编程语言的某种特性，而更依赖于在第3层创建的工具。

### 当心落石 Watch for falling rocks
任何警告信息应让你质疑程序的质量。将警告信息看成是“质疑之源”，将促使你去寻求更满意的解决之道。
考虑程序的缜密程度会对程序质量有决定性作用，关注警告信息也直接影响到最终产品的质量。

### 迭代，反反复复，一次又一次 Iterate, repeatedly, again and again
在生成产品前的反复是加深了解产品的一种途径。
软件设计是一个逐步精化的过程，需要经过反复修正和改进。
软件往往要通过实证而不是证明，这意味着它就得反复测试和开发，直至能正确解决问题为止。
软件工程的诀窍在于，在早期开发阶段的迭代过程中，需要快速地构建尽量多地东西，之后丢弃之也不会花费多大代价。

### 汝当分离软件和信仰 Thou shalt rend software and religion asunder
在软件开发中存在着多种表现形式——非要坚持某种设计方法，笃信特定的布局或注释风格，极力避免全局数据等，不管哪种情况，都是不合适的。

#### 软件先知 Software oracles
革新方法需要公开，才能让别人尝试。尝试这些方法后才能充分证实或反驳之。
不要盲目跟风，而应该使用一种混合的方法，可用激动人心的最新方法做试验，但仍扎根于传统的可靠的方法。

#### 折中主义 Electicism
要对编程问题找出最有效的解决方案时，盲目迷信某种方法只会缩小你的选择余地。受限于所坚持的思路，很可能与最有效的方法失之交臂。
折中主义是一种有益的态度，工程学的规则之一就是权衡各种技术，如果早早将自己的选择限制在单一工具上，就无法做出权衡。
工具箱形象地比喻出抽象的折中思想，顽固的态度与软件创建中的可选择工具箱方法背道而驰，不是创建高质量软件所应持的态度。

#### 试验 Experimentation
试验应贯穿于整个开发过程。“试图没有错误”是最大的错误，设计正是仔细地规划小错误以避免大错误的过程，软件开发中的试验是为了验证某种方法是否可行，只要它解决了问题，就算是成功了。
试验可用在许多层次上，当你需要选择时，就要搞个相应的试验，看看哪个方法最佳。

**对于软件开发的各方面，需要保持开放的心态，这样才能从开发过程和产品中有所收获**。

























## 参考
[1] Steve, McConnell 著, 金戈, 汤凌, 陈硕, & 张菲. (2011). 代码大全(第2版). 电子工业出版社.
