---
title: 同源策略
date: 2021-10-04 09:7
tags:
categories:
- 找工作
---

同源策略（SOP，Same-origin policy）就是规定了不同域之间访问的策略。

域就是`协议://域名:端口`

所谓同源就是要求, 协议、域名、端口相同，非同源的脚本不能访问或者操作其他域的页面对象(如DOM等). 

不同的域下面存了不同的数据，例如 cookie 等，当发起同源请求肯定会带上本域的 cookie，访问其他网站的接口，发起跨域请求的时候，cookie 默认不会带上去的。同时本页面的域，页面会限制你只能看到自己域下的数据。同时跨域发送请求是没问题的，但是跨域返回的结果是不能加载的，原因就是不安全，ajax请求受 SOP 限制。

自然的，浏览器肯定有跨域请求加载资源的需求了，比如加载其他域下的资源，图片，css，js库等，这些通过img link script 等标签去加载。这些都不算违背 SOP。如果你要跨域访问接口，有很多种方法，例如 cors，jsonp(jsonp 的核心原理就是目标页面回调本地页面的方法,并带入参数)，代理等等。

iframe限制
- 可以访问同域资源, 可读写;
- 访问跨域页面时, 只读.

Ajax限制
- 同域资源可读写;
- 跨域请求会直接被浏览器拦截.(chrome下跨域请求不会发起, 其他浏览器一般是可发送跨域请求, 但响应被浏览器拦截)

Script限制
- script 并无跨域限制, 这是因为 script 标签引入的文件不能够被客户端的 js 获取到, 不会影响到原页面的安全, 因此 script 标签引入的文件没必要遵循浏览器的同源策略. 相反, ajax 加载的文件内容可被客户端 js 获取到，引入的文件内容可能会泄漏或者影响原页面安全, 故，ajax必须遵循同源策略。

这里需要澄清一个概念, 所谓的域, 跟 js 等资源的存放服务器没有关系, 比如你到 baidu.com 使用 script 标签请求了 google.com 下的js, 那么该 js 所在域是 baidu.com, 而不是 google.com. 换言之, 它能操作baidu.com的页面对象, 却不能操作google.com的页面对象.


源的更改

页面可能会更改其自己的来源，但有一些限制。脚本可以将 `document.domain` 的值设置为其当前域或其当前域的超级域。如果将其设置为其当前域的超级域，则较短的域将用于后续原始检查。

```js
// 假设文档中的一个脚本在 http://store.company.com/dir/other.html 执行以下语句：

document.domain = "company.com";

// 这条语句执行之后，页面将会成功地通过对 http://company.com/dir/page.html 的同源检测。
// 而同理，company.com 不能设置 document.domain 为 othercompany.com.
```